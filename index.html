<!doctype html><html lang="es"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>RSF - Dashboard</title><link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png">
<link rel="shortcut icon" href="assets/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.png">
<link rel="manifest" href="assets/site.webmanifest">
<link rel="stylesheet" href="assets/style.css"></head><body><header class="topbar">
  <div class="brand">
    <div class="logo" id="logo-container"></div>
    <h1 data-i18n="brand">RESTAURANTES SIN FRONTERAS</h1>
  </div>
  <button id="menu-btn" class="menu-btn" aria-label="Menú" title="Menú">
    <span></span>
    <span></span>
    <span></span>
  </button>
  <nav class="nav" id="main-nav">
    <a href="index.html" data-i18n="nav_dashboard">Dashboard</a>
    <a href="restaurantes.html" data-i18n="nav_restaurants">Restaurantes</a>
    <a href="menus.html" data-i18n="nav_menus">Menús</a>
    <a href="facturacion.html" data-i18n="nav_billing">Facturación</a>
    <a href="reportes.html" data-i18n="nav_reports">Reportes</a>
    <a href="opiniones.html" data-i18n="nav_opinions">Opiniones</a>
    <a href="login.html" data-i18n="login">Login</a>
    <a href="users.html" data-admin-only>Usuarios</a>
  </nav>
  <div class="controls">
    <select id="lang-select" onchange="setLang(this.value)"><option value="es">ES</option><option value="en">EN</option></select>
    <button id="login-btn" onclick="showLogin()" data-i18n="login">Login</button>
    <span id="user-badge" class="user-badge hidden"></span>
  </div>
</header>

<main class="container">
<section class="card">
<h2 data-i18n="nav_dashboard">Dashboard</h2>
  <div class="grid">
  <a class="card stat-card" href="restaurantes.html" title="Ver restaurantes">
    <h3>Total Restaurantes</h3>
    <p id="total-restaurants">0</p>
  </a>
  <a class="card stat-card" href="facturacion.html" title="Ver ventas">
    <h3>Total Ventas</h3>
    <p id="total-sales">0</p>
  </a>
  <a class="card stat-card" href="opiniones.html" title="Ver opiniones">
    <h3>Opiniones</h3>
    <p id="total-opinions">0</p>
  </a>
</div>
<div class="card">
  <h3>Últimos restaurantes</h3>
  <ul id="recent-restaurants" class="small"></ul>
</div>
  <div class="card">
  <h3 data-i18n="chain_info">Información de la Cadena</h3>
  <label data-i18n="name">Nombre:<input id="chain-name" data-readonly-for-viewer/></label>
  <label data-i18n="desc">Descripción:<input id="chain-desc" data-readonly-for-viewer/></label>
  <button onclick="saveChain()" data-readonly-for-viewer>Guardar</button>
</div>
</section>
</main>
<footer class="footer">© <span id="year"></span> RESTAURANTES SIN FRONTERAS - RSF. <span data-i18n="rights">Todos los derechos reservados.</span></footer>
<div id="login-modal" class="card hidden" style="position:fixed;right:20px;top:80px;max-width:260px;">
  <h4>Login </h4>
  <p class="small">Selecciona un rol:</p>
  <button onclick="quickLogin('DUEÑO')">Admin (DUEÑO)</button> <button onclick="quickLogin('EMPLEADO1')">Staff (EMPLEADO1)</button> <button onclick="quickLogin('user')">Usuario (user)</button>
</div>
<script src="assets/app.js"></script>
<script>
document.addEventListener('DOMContentLoaded', async ()=>{
  document.getElementById('year').textContent = new Date().getFullYear();
  applyLang(); renderLogo(); await updateDashboard();
});
async function updateDashboard(){
  let data;
  if(typeof apiRequest === 'function' && (await probeApi())){
    try{ data = { restaurants: await apiRequest('/api/restaurants'), invoices: [], opinions: [] }; } catch(err){ data = JSON.parse(localStorage.getItem('rsf_data_v2')||'{}'); }
  } else { data = JSON.parse(localStorage.getItem('rsf_data_v2')||'{}'); }
  const restaurantsCount = (data.restaurants||[]).length;
  const opinionsCount = (data.opinions||[]).length;
  const sales = (data.invoices||[]).reduce((s,i)=>s+(i.total||0),0);
  animateCounter('total-restaurants', restaurantsCount);
  animateCounter('total-opinions', opinionsCount);
  animateCounter('total-sales', sales);
  // recent restaurants (last 3)
  const recentList = document.getElementById('recent-restaurants');
  recentList.innerHTML = '';
  (data.restaurants||[]).slice(-3).reverse().forEach(r=>{ const li = document.createElement('li'); li.textContent = `${r.name} — ${r.city}`; recentList.appendChild(li); });
  document.getElementById('chain-name').value = (data.chain && data.chain.name) || '';
  document.getElementById('chain-desc').value = (data.chain && data.chain.desc) || '';
}
function saveChain(){
  const data = JSON.parse(localStorage.getItem('rsf_data_v2')||'{}');
  data.chain = {name:document.getElementById('chain-name').value, desc:document.getElementById('chain-desc').value};
  localStorage.setItem('rsf_data_v2', JSON.stringify(data));
  alert('Guardado');
  updateDashboard();
}
</script>
</body></html>
